---
title: New and noteworthy in mycheckpoint (rev. 57)
date: 2009-12-16 21:12:07.000000000 +01:00
type: post
published: true
status: publish
categories:
- MySQL
tags:
- Graphs
- Monitoring
- mycheckpoint
meta:
  _edit_last: '2'
author:
  login: shlomi
  email: shlomi@openark.org
  display_name: shlomi
  first_name: Shlomi
  last_name: Noach
---
<p>Rev. 57 of <a href="http://code.openark.org/forge/mycheckpoint">mycheckpoint</a> has been released and is available for <a href="http://code.google.com/p/mycheckpoint/">download</a>.</p>
<p>New and updated in this revision:</p>
<ul>
<li><a href="#Remote host monitoring">Remote host monitoring</a></li>
<li><a href="#Improved charting">Improved charting</a></li>
<li><a href="#Flexible charting">Flexible charting</a></li>
<li><a href="#Fix to questions vs. queries issues">Fix to questions vs. queries issues</a></li>
</ul>
<p><a name="Remote host monitoring"></a></p>
<h4>Remote host monitoring</h4>
<p>It is now possible to monitor one host, while writing into another. Either or both could be remote hosts:</p>
<blockquote>
<pre>mycheckpoint --host=localhost --monitored-host=192.168.10.178</pre>
</blockquote>
<p>The above monitors the MySQL server on 192.168.10.178, and writes down to localhost (to be queried later)</p>
<blockquote>
<pre>mycheckpoint --monitored-host=127.0.0.1 --host=192.168.10.178</pre>
</blockquote>
<p>The above monitors the MySQL server on 127.0.0.1, and writes down to 192.168.10.178.</p>
<p><!--more-->As result of the above addition, binary logging for monitoring statements are now enabled by default. The previous solution, in which binary logging were disabled by default and the same schema was utilized by different servers was far from being a clean solution. <em>[Read more on <a href="http://code.openark.org/forge/mycheckpoint/documentation/remote-multiple-hosts">Remote &amp; multiple hosts</a> monitoring]</em></p>
<p><a name="Improved charting"></a></p>
<h4>Improved charting</h4>
<p>The google charts reports have been improved significantly. Here's how:</p>
<blockquote><p><img class="size-full wp-image-1702" title="Before" src="{{ site.baseurl }}/assets/chart-old-sample11.png" alt="Before" width="400" height="200" /><img class="size-full wp-image-1703" title="After" src="{{ site.baseurl }}/assets/chart-new-sample1.png" alt="After" width="400" height="200" /><br />
<strong>Before</strong> on left (or above), <strong>After</strong> on right (or below)</p></blockquote>
<p>And</p>
<blockquote><p><img class="size-full wp-image-1708" title="Before" src="{{ site.baseurl }}/assets/chart-old-sample2.png" alt="Before" width="400" height="200" /><img class="size-full wp-image-1709" title="After" src="{{ site.baseurl }}/assets/chart-new-sample2.png" alt="After" width="400" height="200" /><br />
<strong>Before</strong> on left (or above), <strong>After</strong> on right (or below)</p></blockquote>
<p><em>Recap</em>: the charts are not stored anywhere; they are being calculated and generated by SQL queries &amp; views, based on the raw data. For example, to generate the above, I do:</p>
<blockquote>
<pre>SELECT innodb_estimated_log_mb_written_per_hour FROM sv_report_chart_sample\G
*************************** 1. row ***************************
innodb_estimated_log_mb_written_per_hour: http://chart.apis.google.com/chart?cht=lc&amp;chs=400x200&amp;chts=303030,12&amp;chtt=Latest+24+hours:+Dec+8,+08:20++-++Dec+9,+08:20&amp;chdl=innodb_estimated_log_mb_written_per_hour&amp;chdlp=b&amp;chco=ff8c00&amp;chd=s:OQOTSPPQPSROUQMTRSQTPSURQTQQPSOSRTRRUTRRTSRRRSRSTRRQSURSUVRRXQTVRUTTVUTOYTXSYTTSYUSUTWUPRRPQSQRQTPPSPQMPPQOQMQPMOMOLQORNNPNRNNOPQOOMQQPNRNMNORQMSTQQPTPRUQVQTTVSURUVVVSSSVWQVUSTVSWSSUURWRVRTWdotpQNROPQRPQQMPLRO9PWNRPNNNPXUMLNNPQQPSONPLLNWXZTQROSQMOONQPLJNOOQQKMPSMMPLfPSSSRTUQSORSSRSPNRSQSQ&amp;chxt=x,y&amp;chxr=1,0,2708.0&amp;chxl=0:|09:00||||13:00||||17:00||||21:00||||01:00||||05:00||||&amp;chxs=0,505050,10&amp;chg=4.17,25,1,3,2.78,0&amp;chxp=0,2.78,6.95,11.12,15.29,19.46,23.63,27.80,31.97,36.14,40.31,44.48,48.65,52.82,56.99,61.16,65.33,69.50,73.67,77.84,82.01,86.18,90.35,94.52,98.69</pre>
</blockquote>
<p>If you thought I was going over the edge in <a href="http://code.openark.org/blog/mysql/auto-scaling-scaled-sql-graphs-concluded">Auto scaling, scaled SQL graphs concluded</a> or <a href="http://code.openark.org/blog/mysql/sql-pie-chart">SQL pie chart</a>, allow me to assure you: generation of the above charts using SQL &amp; views is <em>SQL blasphemy</em>. While cool, the Google Charts API does not do too much on its own, and expects the caller to do the math for putting in the grids, scales and labels (and though all of them are tightly related, they must all be explicitly specified). I'll write a later post on this.</p>
<p><a name="Flexible charting"></a></p>
<h4>Flexible charting</h4>
<p>A new table, called <strong>charts_api</strong>, is introduced. It contains one row, which lists charting configuration.</p>
<blockquote>
<pre>SELECT * FROM charts_api;
+-------------+--------------+----------------------------------------------------------------+------------------------------------+
| chart_width | chart_height | simple_encoding                                                | service_url                        |
+-------------+--------------+----------------------------------------------------------------+------------------------------------+
|         400 |          200 | ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789 | http://chart.apis.google.com/chart |
+-------------+--------------+----------------------------------------------------------------+------------------------------------+</pre>
</blockquote>
<p>To change generated charts dimensions, simply update <strong>chart_width</strong> or <strong>chart_height</strong>.</p>
<p>To use other chart APIs, update <strong>service_url</strong>. I've tried out <a href="http://www.jfree.org/eastwood/">Eastwood Charts</a>, a Java-based service, which implements the Google Charts API. There's still some stuff missing, such as the positioning of labels and grids; and it's slightly less polished (but configurable). But if you're concerned about sending requests to Google, it's a viable alternative.</p>
<p>So, drop the WAR file into your <a href="http://tomcat.apache.org/">Tomcat</a> / <a href="http://www.jboss.org/">JBoss</a> / other j2ee server, then follow <strong>http://127.0.0.1/eastwood/chart?</strong>...</p>
<p><a name="Fix to questions vs. queries issues"></a></p>
<h4>Fix to questions vs. queries issues</h4>
<p><em>mycheckpoint</em> now correctly identifies whether to use <a href="http://code.openark.org/blog/mysql/questions-or-queries">questions or queries</a> when analyzing DML queries. If you got some <strong>570%</strong> for <strong>com_update</strong> out of total queries and wondered about it, it should now be resolved to normal values.</p>
<h4>On upgrading your current installation</h4>
<ol>
<li>Download &amp; install via debian or python installers</li>
<li>Issue <em>mycheckpoint</em> once with "deploy" as argument</li>
<li>Done</li>
</ol>
<h4>Future plans</h4>
<p>I'm working on 24x7 charting; minimal operating system monitoring; auto-detection and auto-deploy on version upgrade; and more.</p>
<p>Stay tuned!</p>
